/*
  mixins.sass
  ============================== */

// Configuration
$fontScale: 62.5% !default

// Helpers
@function __listToString($list, $glue: '', $is-nested: false)
  $result: null
  @for $i from 1 through length($list)
    $e: nth($list, $i)
    @if type-of($e) == list
      $result: unquote("#{$result}#{to-string($e, $glue, true)}")
    @else
      $result: if($i != length($list) or $is-nested, unquote("#{$result}#{$e}#{$glue}"), unquote("#{$result}#{$e}"))
  @return $result

@function __stripUnit($number)
  @if type-of($number) == 'number' and not unitless($number)
    @return $number / ($number * 0 + 1)
  @return $number

@function __appendToImageFilename($filename, $value)
  $exts: '.png' '.jpg' '.jpeg' '.bmp' '.gif' '.svg'
  $index: null
  $extension: null
  @each $ext in $exts
    @if str-index($filename, $ext)
      $index: str-index($filename, $ext)
      $extension: $ext
  @if $index and $extension
    $newFilename: str-insert($filename, $value, $index)
    @return $newFilename
  @else
    @error 'Appending to filename \'#{$filename}\' failed.'

@function __toLength($value, $unit)
  $units: ('px': 1px, 'cm': 1cm, 'mm': 1mm, '%': 1%, 'ch': 1ch, 'pc': 1pc, 'in': 1in, 'em': 1em, 'rem': 1rem, 'pt': 1pt, 'ex': 1ex, 'vw': 1vw, 'vh': 1vh, 'vmin': 1vmin, 'vmax': 1vmax)
  @if not index(map-keys($units), $unit)
    @error 'Invalid unit \'#{$unit}\'.'
  @return $value * map-get($units, $unit)

@function __toNumber($value)
  @if type-of($value) == 'number'
    @return $value
  @else if type-of($value) != 'string'
    @error 'Value for __toNumber() should be a number or a string.'
  $result: 0
  $digits: 0
  $minus: str-slice($value, 1, 1) == '-'
  $numbers: ('0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9)
  @for $i from if($minus, 2, 1) through str-length($value)
    $character: str-slice($value, $i, $i)
    @if not (index(map-keys($numbers), $character) or $character == '.')
      @return __toLength(if($minus, -$result, $result), str-slice($value, $i))
    @if $character == '.'
      $digits: 1
    @else if $digits == 0
      $result: $result * 10 + map-get($numbers, $character)
    @else
      $digits: $digits * 10
      $result: $result + map-get($numbers, $character) / $digits
  @return if($minus, -$result, $result)

// Proportional
@function em($px, $scale: $fontScale, $unit: 'em')
  @return __toNumber($px/(.16*__stripUnit($scale)) + $unit)

@function rem($px, $scale: $fontScale)
  @return em($px, $scale, 'rem')

=clearfix()
  &:after, &:before
    content: ''
    display: table
  &:after
    clear: both

=aspect-ratio($ratio-or-width, $height: null)
  $padding: if($height, percentage($height/$ratio-or-width), percentage(1/$ratio-or-width))
  &:before
    content: ''
    float: left
    padding-bottom: $padding
  &:after
    content: ''
    display: table
    clear: both

=distribute($args: (), $dir: row)
  $flexMap: (left: flex-start, right: flex-end, top: flex-start, bottom: flex-end, center: center)
  @if length($args) == 2
    display: flex
    flex-direction: $dir
    @if $dir == 'row'
      justify-content: map-get($flexMap, nth($args, 1)) or nth($args, 1)
      align-items: map-get($flexMap, nth($args, 2)) or nth($args, 2)
    @else if $dir == 'column'
      justify-content: map-get($flexMap, nth($args, 2)) or nth($args, 2)
      align-items: map-get($flexMap, nth($args, 1)) or nth($args, 1)
    @else
      @warn 'Invalid direction: \'#{$dir}\'.'
  @else
    @warn 'Invalid length of arguments \'#{length($args)}\' for distribute() in chain \'#{&}\'.'

=indent($args: (), $exclude: null)
  $offsets: top right bottom left
  $selector: ()
  @if $exclude
    $selector: '& > *:not(:#{$exclude})'
  @else
    $selector: '& > *'
  #{$selector}
    @each $offset in $offsets
      $index: index($args, $offset)
      @if $index
        $next: nth($args, $index + 1)
        @if type-of($next) == 'number'
          margin-#{$offset}: $next
        @else
          @warn 'Invalid value \'#{$next}\' for indent() in chain \'#{&}\'.'

// Typography
=hide-text()
  text-indent: 100%
  white-space: nowrap
  overflow: hidden

=truncate-text($width: 100%)
  max-width: $width
  white-space: nowrap
  overflow: hidden
  text-overflow: ellipsis

=unselectable()
  user-select: none
  -webkit-touch-callout: none
  -webkit-tap-highlight-color: rgba(0,0,0,0)

// Media
=background-retina($src, $args: ())
  background-image: url($src)
  @if length($args) == 2
    background-size: nth($args, 1) nth($args, 1)
  @else if length($args) == 1
    background-size: $args
  +media('retina2x')
    background-image: __appendToImageFilename($src, '@2x')
  +media('retina3x')
    background-image: __appendToImageFilename($src, '@3x')

// Effects
=transition($props: (), $duration: (), $easing: ('linear'), $delay: ('0ms'))
  transition-property: __listToString($props, ', ')
  transition-duration: __listToString($duration, ', ')
  transition-timing-function: __listToString($easing, ', ')
  transition-delay: __listToString($delay, ', ')
  will-change: __listToString($props, ', ')
